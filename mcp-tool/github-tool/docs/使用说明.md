# GitHub MCP 工具使用说明

## 安装

### 1. 安装依赖

```bash
# 激活 conda 环境（根据你的实际情况调整）
conda activate py311_gb25MCP_01

# 进入项目目录
cd /path/to/gd25-mcp-tool/mcp-tool/github-tool

# 安装依赖
pip install -r requirements.txt
```

### 2. 获取 GitHub Token

1. 登录 GitHub，进入 **Settings** → **Developer settings** → **Personal access tokens** → **Tokens (classic)**
2. 点击 **Generate new token (classic)**
3. 设置 Token 名称和过期时间
4. 选择权限（scopes）：
   - `public_repo`：访问公共仓库（必需）
   - `repo`：访问私有仓库（如果需要）
   - `read:org`：读取组织信息（如果需要）
5. 点击 **Generate token**
6. **重要**：复制生成的 Token（只显示一次）

### 3. 配置环境变量

创建 `.env` 文件或设置环境变量：

```bash
# 必需：GitHub 个人访问令牌
export GITHUB_TOKEN="your_github_token_here"

# 可选：日志级别（DEBUG, INFO, WARNING, ERROR）
export LOG_LEVEL="INFO"
```

或者在项目目录下创建 `.env` 文件：

```env
GITHUB_TOKEN=your_github_token_here
LOG_LEVEL=INFO
```

## 在 Cursor 中配置

### 1. 找到 Cursor 配置文件

Cursor 的 MCP 配置文件通常位于：
- macOS: `~/Library/Application Support/Cursor/User/globalStorage/rooveterinaryinc.roo-cline/settings/cline_mcp_settings.json`
- Windows: `%APPDATA%\Cursor\User\globalStorage\rooveterinaryinc.roo-cline\settings\cline_mcp_settings.json`
- Linux: `~/.config/Cursor/User/globalStorage/rooveterinaryinc.roo-cline/settings/cline_mcp_settings.json`

或者通过 Cursor 设置界面：**Preferences** → **Cursor Settings** → **MCP**

### 2. 添加 GitHub MCP 服务器配置

在配置文件中添加：

```json
{
  "mcpServers": {
    "github": {
      "command": "/opt/homebrew/Caskroom/miniconda/base/envs/py311_gb25MCP_01/bin/python",
      "args": [
        "/path/to/gd25-mcp-tool/mcp-tool/github-tool/server.py"
      ],
      "env": {
        "GITHUB_TOKEN": "your_github_token_here",
        "LOG_LEVEL": "INFO"
      }
    }
  }
}
```

**注意**：请根据实际情况修改：
- `command`：你的 conda 环境 Python 路径
- `args[0]`：`server.py` 的实际路径
- `env.GITHUB_TOKEN`：你的 GitHub Token

### 3. 验证配置

1. 保存配置文件
2. 重启 Cursor
3. 在 Cursor 中，你应该能看到 GitHub MCP 服务器已连接（状态显示为绿色）

## 使用方法

### 在 Cursor 中使用工具

配置完成后，你可以在 Cursor 中通过自然语言与 GitHub 交互，例如：

1. **搜索代码**：
   - "搜索 Python 中的 hello 函数"
   - "在 owner/repo 仓库中查找 test.py 文件"

2. **获取仓库信息**：
   - "获取 owner/repo 仓库的信息"
   - "查看 python/cpython 仓库的详细信息"

3. **获取文件内容**：
   - "获取 owner/repo 仓库中 src/main.py 文件的内容"
   - "查看 owner/repo 仓库的 README.md 文件"

4. **管理 Issue**：
   - "列出 owner/repo 仓库的所有 open Issue"
   - "在 owner/repo 仓库中创建一个新 Issue，标题是 'Bug fix'"

5. **查看 Pull Request**：
   - "列出 owner/repo 仓库的所有 open Pull Request"

### 工具详细说明

#### search_code
搜索 GitHub 上的代码，支持 GitHub 搜索语法。

**示例查询**：
- `language:python def hello` - 在 Python 代码中搜索 "def hello"
- `repo:owner/repo filename:test.py` - 在指定仓库中搜索文件
- `user:username language:javascript` - 在指定用户的仓库中搜索 JavaScript 代码

#### get_repo_info
获取仓库的详细信息，包括：
- 仓库名称和描述
- 主要编程语言
- Star 数、Fork 数
- Issue 数量
- 默认分支
- 创建和更新时间

#### get_file_content
获取仓库中指定文件的内容。支持：
- 指定分支、标签或提交 SHA
- 自动解码 Base64 编码的文件内容

#### list_issues
列出仓库的 Issue，支持：
- 按状态过滤（open, closed, all）
- 限制返回数量（最多 100 条）

#### create_issue
在仓库中创建新的 Issue，支持：
- 设置标题和内容（Markdown 格式）
- 添加标签

#### list_pull_requests
列出仓库的 Pull Request，支持：
- 按状态过滤（open, closed, all）
- 限制返回数量（最多 100 条）

## 测试服务器

### 使用 MCP Inspector 测试

```bash
# 确保已设置环境变量
export GITHUB_TOKEN="your_token"

# 运行服务器
python server.py
```

服务器会通过 stdio 与 Cursor 通信，你可以通过 MCP Inspector 工具测试。

### 直接测试 GitHub 客户端

你可以创建一个简单的测试脚本：

```python
from github_client import GitHubClient
import os

token = os.getenv('GITHUB_TOKEN')
client = GitHubClient(token)

# 测试搜索代码
result = client.search_code("language:python def hello")
print(result)

# 测试获取仓库信息
repo_info = client.get_repo_info("octocat", "Hello-World")
print(repo_info)
```

## 常见问题

### 1. Token 无效或权限不足

**错误信息**：`Bad credentials` 或 `Not Found`

**解决方法**：
- 检查 Token 是否正确设置
- 确认 Token 有足够的权限（scopes）
- 如果访问私有仓库，需要 `repo` 权限

### 2. 速率限制

**错误信息**：`API rate limit exceeded`

**解决方法**：
- GitHub API 有速率限制（未认证：60 次/小时，认证：5000 次/小时）
- 使用认证 Token 可以提高限制
- 等待一段时间后重试

### 3. 仓库不存在

**错误信息**：`仓库不存在: owner/repo`

**解决方法**：
- 检查仓库名称是否正确
- 确认仓库是公开的，或者 Token 有访问权限

### 4. 文件不存在

**错误信息**：`文件不存在: owner/repo/path`

**解决方法**：
- 检查文件路径是否正确
- 确认文件存在于指定的分支/标签

## 安全注意事项

1. **保护 GitHub Token**：
   - 不要将 Token 提交到版本控制系统
   - 使用环境变量或 `.env` 文件（已添加到 .gitignore）
   - 定期轮换 Token

2. **权限最小化**：
   - 只授予必要的权限（scopes）
   - 如果只需要访问公共仓库，使用 `public_repo` 权限即可

3. **Token 过期**：
   - 定期检查 Token 是否过期
   - 过期后需要重新生成并更新配置

